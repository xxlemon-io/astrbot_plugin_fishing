![:astrbot_plugin_fish](https://count.getloli.com/@:astrbot_plugin_fish?theme=capoo-1)

<div align="center">

# 🎣 AstrBot 钓鱼插件

## 🚀 重大更新通知 🚀

<div style="background: linear-gradient(135deg, #0ea5e9 0%,#86a4f8 100%); padding: 20px; border-radius: 15px; margin: 20px 0; box-shadow: 0 8px 32px hsla(199, 94.70%, 62.70%, 0.89);">

### ✨ **v2.0.0 震撼发布** ✨

🎉 **史上最重大更新！**

🔥 **全新商店系统** - 多商店类型，复杂商品机制，Web管理界面  
🏷️ **统一短码系统** - 所有物品使用Base36编码，操作更便捷  
🐟 **鱼类市场支持** - 鱼类可上架交易，支持匿名上架  
🔍 **偷看鱼塘功能** - 查看他人鱼塘，社交互动升级  
🐠 **水族箱系统** - 安全存储空间，防偷保护，容量升级  
🎨 **稀有度颜色扩展** - 6-10星专属颜色，视觉效果更佳  
⚡ **性能大幅优化** - 线程安全，消息保护，响应更快  

**立即体验全新2.0版本，感受前所未有的钓鱼乐趣！** 🎊

</div>

</div>

一个功能齐全的钓鱼游戏系统插件，为您的机器人添加有趣的钓鱼休闲游戏。

[![AGPL-3.0 License](https://img.shields.io/badge/License-AGPL--3.0-blue.svg)](https://opensource.org/licenses/AGPL-3.0)
[![Python](https://img.shields.io/badge/Python-3.8+-green.svg)](https://python.org)
[![AstrBot](https://img.shields.io/badge/AstrBot-Plugin-orange.svg)](https://github.com/astrbot/astrbot)
[![Version](https://img.shields.io/badge/Version-2.2.3-brightgreen.svg)](https://github.com/xxlemon-io/astrbot_plugin_fishing/releases/tag/v2.2.3)
[![Major Update](https://img.shields.io/badge/Major-Update-red.svg)](https://github.com/xxlemon-io/astrbot_plugin_fishing/releases/tag/v2.0.0)

## ✨ 功能特点

<div align="center">

### 🆕 **v2.0.0 全新特性** 🆕

</div>

- **完整的钓鱼游戏系统**：多种鱼类和稀有度，丰富的钓鱼体验
- **可扩展的稀有度系统**：支持1-10星稀有度，新增6-10星颜色映射
- **🆕 全新商店系统**：多商店类型（普通、高级、限时），支持复杂商品机制和成本组合
- **🆕 统一短码系统**：所有物品使用Base36编码，操作更便捷
- **🆕 鱼类市场支持**：鱼类可上架交易，支持匿名上架
- **🆕 偷看鱼塘功能**：查看他人鱼塘，社交互动升级
- **🆕 水族箱系统**：安全存储空间，防偷保护，容量升级机制
- **🆕 交易所系统**：大宗商品交易，动态价格，盈亏分析，容量管理
- **智能区域访问控制**：通行证机制，不同区域有不同的进入要求
- **装备精炼系统**：鱼竿、饰品可精炼升级，提升属性加成
- **装备保护系统**：锁定功能保护高级装备，防止意外操作
- **道具系统**：丰富的道具效果，包括通行证、护符、增益道具等
- **经济系统**：金币、高级货币双货币体系，市场交易系统
- **抽卡系统**：多种卡池，限时活动，十连保底机制
- **社交功能**：排行榜、偷鱼、成就称号系统
- **后台管理**：Web管理界面，支持数据导入导出，灵活配置游戏参数
- **🆕 线程安全优化**：DatabaseConnectionManager提供稳定的数据库连接管理
- **🆕 消息保护机制**：自动截断超长消息，防止显示问题
- **🆕 电鱼功能**：新增电鱼玩法，可以电击其他玩家的鱼塘，支持功能开关配置
- **🆕 猜大小游戏**：新增骰宝游戏，支持多种下注方式
- **🆕 命运之轮**：新增命运之轮游戏，高风险高回报的轮盘游戏
- **🆕 批量稀有度出售**：支持按稀有度批量出售鱼类
- **🆕 每日重置时间配置**：可配置每日重置时间点，灵活管理游戏节奏
- **🆕 擦弹炸弹系统**：优化擦弹炸弹功能，增加更多策略性
- **数据兼容**：支持导入1.4.6版本数据，平滑升级体验

## 🔧 安装方法

1. 将此插件放入 `data/plugins/` 目录。或者安装插件时→从链接安装→本项目地址
2. 重启 AstrBot 或使用插件管理命令加载插件

## 💡 未来计划

如果你有什么想法，欢迎提交issue！期待您天马行空的想法

### 🤝 开发计划

- [x] 分离成就模块，以便于未来拓展
- [x] 丰富图鉴类命令 ➞　图片输出的图鉴命令
- [x] 将部分输出结果改写成输出图片
- [x] 钓鱼区域功能扩展
- [x] 更多经济系统
- [x] 重构商店系统
- [x] 扩展背包，增加道具栏
- [x] 装备保护系统（锁定功能）
- [x] 更多社交玩法

#### 📋 当前开发状态

**2.0版本已完成所有主要功能开发**，目前没有新的功能开发计划。

**后续版本将专注于：**
- 🐛 **Bug修复**：修复用户反馈的问题和已知bug
- 🔧 **性能优化**：提升系统稳定性和响应速度
- 📝 **代码优化**：改进代码质量和可维护性
- 🛡️ **安全加固**：增强系统安全性

如果您有功能建议或发现问题，欢迎在 [Issues](https://github.com/xxlemon-io/astrbot_plugin_fishing/issues) 中提出！
 
## 📦 更新记录

#### v2.2.3 (命运轮盘配置修复 + 帮助图像更新 + 税收系统重构)

- **🐛 修复命运轮盘次数显示不匹配**：修复/状态命令中命运轮盘次数与配置不同步的问题
- **🔧 配置同步优化**：确保所有命运轮盘次数相关显示都从配置文件读取
- **🔧 修复game_config配置缺失**：全面修复main.py中缺失的配置项传递
- **🚨 重构独立税收线程**：税收现在完全独立于自动钓鱼功能，保证每日准时执行
- **🖼️ 补全钓鱼帮助图像**：更新 `/钓鱼帮助` 命令的图像输出，补充了自2.2.0版本以来的新增命令
- **🎰 新增抽卡玩法展示**：添加命运之轮、骰子游戏等新玩法到帮助图像
- **⚡ 新增电鱼功能展示**：在社交功能区显示电鱼命令说明
- **📈 新增交易所功能展示**：添加完整的大宗商品交易所命令说明
- **🎨 优化帮助布局**：自动计算高度以适应新增命令，保持视觉美观

#### v2.2.2 (商店/兑换系统优化)

- **🔧 优化商店OR条件兑换逻辑**：使用递归回溯算法智能选择支付组合
- **⚡ 批量查询性能优化**：新增批量鱼类库存查询方法，提升性能
- **🐛 修复OR条件资源检查问题**：确保多条件支付的准确性和原子性

*感谢 [@WWWA7](https://github.com/WWWA7) 的贡献 ([#57](https://github.com/xxlemon-io/astrbot_plugin_fishing/pull/57))*

#### v2.2.1 (命运轮盘平衡调整)

- **⚖️ 命运轮盘平衡调整**：每日次数限制从5次调整为3次，重新设计为高风险高回报模型
- **🔧 命运轮盘可配置**：每日次数限制现在可通过配置文件调整，默认值为3次
- **🎯 庄家优势保证**：整体House Edge约67%

#### v2.2.0 (新游戏玩法与功能优化)

- **⚡ 电鱼功能**：新增电鱼玩法，可以电击其他玩家的鱼塘，获得特殊奖励
- **🎲 猜大小游戏**：新增骰宝游戏，支持大小、单双、点数等多种下注方式
- **🎰 命运之轮**：新增命运之轮游戏，高风险高回报的轮盘游戏，支持多轮挑战
- **📦 批量稀有度出售**：支持按稀有度批量出售鱼类，提升管理效率
- **⏰ 每日重置时间配置**：可配置每日重置时间点（0-23小时），灵活管理游戏节奏
- **💣 擦弹炸弹系统优化**：优化擦弹炸弹功能，增加更多策略性和趣味性
- **🔧 系统优化**：改进错误处理、代码可读性和用户体验
- **📊 数据统计增强**：优化总价值计算和显示功能

*感谢 [@WWWA7](https://github.com/WWWA7) 的贡献 ([#47](https://github.com/xxlemon-io/astrbot_plugin_fishing/pull/47))*

#### v2.1.0 (交易所系统)

- **💼 全新交易所系统**：支持大宗商品（鱼干、鱼油、鱼卵）的买卖交易
- **📈 动态价格机制**：商品价格每日波动，基于趋势、随机性和特殊事件
- **📊 详细盈亏分析**：显示总成本、总收入、净盈亏、盈利率，帮助用户了解投资表现
- **📦 商品腐败系统**：商品有1-3天腐败时间，过期自动清理，增加策略性
- **⚖️ 容量管理**：总持仓上限1000份，上架商品仍占用容量，增加投资决策难度
- **💰 税收系统**：交易收取5%税费，增加经济平衡性
- **🏪 市场集成**：大宗商品可上架到玩家市场，支持匿名交易
- **🔧 统一短码**：使用C开头的短码（如C1A）进行商品操作
- **📋 便捷命令**：支持按商品名称卖出、清仓、持仓查看等便捷操作
- **⚙️ 可配置参数**：容量上限、税率等参数可通过配置文件调整

#### v2.0.9 (沙漏预测系统Bug修复)

- **🔧 修复沙漏预测Bug**：修复了沙漏预测到高倍率时必定获得高倍率奖励的严重bug
- **⚖️ 恢复预测本质**：预测功能现在只提前告知结果，不再影响实际擦弹概率分布
- **🎯 保持游戏平衡**：无论预测结果如何，实际擦弹都按照原始概率进行，确保游戏公平性
- **🙏 致歉说明**：对于上个版本中沙漏预测功能影响游戏平衡的问题，深表歉意，现已完全修复

#### v2.0.8 (沙漏预测系统平衡性调整)

- **🔮 沙漏预测削弱**：将预测准确率从100%降低到33.3%，增加游戏平衡性
- **❌ 占卜失败机制**：新增33%的占卜失败概率，失败时无法获得任何预测结果
- **🎲 错误预测优化**：33.4%概率获得错误预测，增加策略性和不确定性


#### v2.0.7 (性能优化与命令重构)

- **⚡ 图像生成优化**：添加超时处理，使用numpy加速渐变生成，优化文本处理
- **🛒 统一出售命令**：引入 `/出售` 命令，支持基于短码的装备出售

#### v2.0.0 (系统重构大规模！ - 重大更新)

- **🏪 全新商店系统**：重构为多商店类型系统，支持普通商店、高级商店、限时商店
- **🛍️ 复杂商品机制**：支持多种成本类型（金币、高级货币、鱼竿、饰品、道具）和奖励机制
- **🔒 线程安全优化**：新增DatabaseConnectionManager，提供线程安全的数据库连接管理
- **🎣 商店商品扩展**：支持鱼竿和饰品作为商店商品，丰富商品类型
- **🌐 Web管理增强**：新增商店管理界面，支持商店创建、商品管理、库存控制
- **⏰ 时间控制功能**：支持商店营业时间、每日营业时间、限时商品等时间控制
- **🚫 限购机制**：支持每人限购、每日限购等购买限制
- **🔗 成本分组系统**：支持复杂的成本组合逻辑（AND/OR关系）
- **🏷️ 显示代码系统**：鱼竿和饰品支持Base36编码的短代码显示，便于用户识别和管理
  - 短代码显示：装备实例现在支持Base36编码的短代码显示
  - 便于识别：用户可以通过短代码快速识别和管理装备
  - 自动生成：系统自动为所有装备实例生成唯一的显示代码
- **🌟 稀有度颜色扩展**：新增6-10星稀有度颜色映射，支持更高稀有度显示
- **🎰 擦弹功能优化**：改进消息格式，添加抑制通知，提升用户体验
- **✂️ 消息截断保护**：防止消息过长导致显示问题，自动截断超长内容
- **🎁 批量道具发放**：管理员可给所有用户批量发放指定道具
- **🐟 鱼类市场支持**：支持鱼类上架和交易，丰富市场商品类型
- **👤 匿名上架功能**：支持匿名上架商品，保护卖家隐私
- **👀 偷看鱼塘功能**：可以查看其他用户的鱼塘和鱼类收藏
- **🔧 统一物品操作**：所有物品使用统一的短码系统进行操作
- **📦 数据迁移**：平滑升级，保持数据兼容性

#### 短码系统说明（2.0版本）

- **短码格式**：所有物品现在使用Base36编码的短码显示
  - `R`开头：鱼竿（如 R2N9C）
  - `A`开头：饰品（如 A7K3Q）
  - `D`开头：道具（如 D1）
  - `B`开头：鱼饵（如 B2）
  - `F`开头：鱼类（如 F3）
  - `C`开头：大宗商品（如 C1A）
  - `M`开头：市场商品（如 M1A2B）

- **统一命令**：所有物品操作现在使用统一的短码格式
  - `/使用 [短码]` - 使用任何类型的物品
  - `/精炼 [短码]` - 精炼鱼竿或饰品
  - `/锁定 [短码]` - 锁定任何装备
  - `/上架 [短码] [价格]` - 上架任何物品到市场

#### 显示代码示例
```
鱼竿: 普通鱼竿 (ID: R2N9C) [3★] 精炼+5
饰品: 幸运护符 (ID: A7K3Q) [4★] 精炼+3
道具: 金币袋 (ID: D1) x10
鱼类: 金鱼 (ID: F3) x5
大宗商品: 鱼油 (ID: C1A) x10 腐败倒计时: 2天
```

#### v1.7.5 (图鉴系统重构)

- **🖼️ 图鉴图片化**：文本图鉴改为美观图片展示，每页显示20个鱼类
- **🎨 背包风格设计**：渐变背景、圆角设计、用户头像集成
- **⚡ 数据优化**：新增统计表提升性能，自动清理历史数据
- **✨ 视觉效果**：丰富色彩搭配，文本符号增强，布局优化

#### v1.7.4 (打开全部钱袋功能)

- **💰 更新 `/打开全部钱袋` 命令**，提升用户体验

#### v1.7.3 (架构重构)

- **🏗️ 统一命令注册方式**，优化代码结构
- **🔗 新增命令别名**，提升用户体验
- **🔄 保持向后兼容**，不改变游戏逻辑

#### v1.7.2 (反制道具系统)

- **🛡️ 新增破灵符、驱灵香、暗影斗篷等反制道具**
- **⚖️ 平衡海灵守护机制**，增加策略性

#### v1.7.1 (稀有度调整)

- **⭐ 稀有鱼范围调整为4星+**
- **🎯 优化配额系统**，提升游戏平衡性

#### v1.7.0 (精炼系统升级)

- **⚠️ 新增降级失败机制**，三种失败结果
- **🔒 优化锁定装备功能**，修复设计失误
- **📈 调整精炼成功率**，提升挑战性

#### v1.6.9 (扩展稀有度系统)

- **⭐ 移除5星限制**，支持任意星级鱼类
- **🔧 后台支持高星级鱼类管理**

#### v1.6.8 (装备保护功能)

- **🔒 新增装备锁定系统**，防止意外操作
- **💥 新增砸锅卖铁功能**，一键清仓

#### v1.6.7 (安全更新)

- **🔐 后台管理地址改为localhost**，提升安全性

#### v1.6.6 (紧急修复)

- **🐛 修复饰品/鱼竿无限卖出Bug**
- **🔇 修复批量使用道具消息刷屏问题**

#### v1.6.5 (钓鱼区域系统)

- **🎫 智能通行证机制**，自动消耗系统
- **⚙️ 后台管理配置**，用户体验提升

#### v1.6.4 (道具系统)

- **🛡️ 新增守护海灵、时运沙漏道具**
- **🎰 擦弹玩法升级**，御神籤风格占卜

#### v1.6.3 (精炼系统)

- **💰 修复精炼金币提示问题**
- **⚖️ 统一精炼失败机制**
- **🔮 新增精炼护符系统**，保护装备精炼
- **⚡ 管理命令精简**，新增同步道具功能

#### v1.6.2 (市场系统)

- **💵 重构出售定价系统**，支持精炼等级乘数
- **📦 优化批量出售功能**

#### v1.6.1 (代码重构)

- **🤖 AI代码审计重构**，性能优化
- **⚡ 异步改造**，提升高并发性能
- **🛡️ 健壮性增强**，路径管理优化
- **🔒 安全加固**，代码去重

#### v1.4.6 - v.1.6.0

- **💎 扩展了高级货币/钻石/星石功能**
- **🎁 增加了道具系统**，现在你有更多机会偷鱼和擦弹！
- **🎰 新增了每日免费一抽**，签到自动抽取
- **🎒 新增了背包功能**，使用/背包来查看所有物品
- **⚡ 更好的精炼系统**，新增了耐久和毁坏机制。使用/精炼命令来查看新特性
- **📊 新增了后台管理界面CSV批量导入鱼竿和饰品**
- **👥 后台管理功能增加了用户管理功能**
- **🏪 后台管理功能增加了市场管理功能**
- **🔧 补充了管理员命令** `/代理上线` 和 `/代理下线`。
- **🔗 新增了很多命令的别名**
- **🎲 更好的卡池管理系统**，支持高级货币和限时卡池
- **🐛 修复了鱼竿的数量加成没有生效的BUG**。


![image](https://github.com/user-attachments/assets/4dd1a179-967f-4cb9-82a5-ca3754b80bb0)
![image](https://github.com/user-attachments/assets/c80550e6-86a2-4373-b593-a7e2a8d0ab6b)
![image](https://github.com/user-attachments/assets/b7fd24bc-c0fe-4cee-9431-41b38af665e6)

## 🎣 钓鱼游戏命令手册 🎣

提示：命令中的 [ID] 表示必填参数，<> 表示可选参数。

### 🎣 基础与核心玩法

| 命令 | 别名 | 描述 |
|---|---|---|
| `/注册` | - | 注册新用户 |
| `/钓鱼` | - | 进行一次钓鱼 |
| `/签到` | - | 每日签到 |
| `/自动钓鱼` | - | 开启/关闭自动钓鱼 |
| `/钓鱼区域 [ID]` | `/区域 [ID]` | 查看或切换钓鱼区域（需要通行证的区域会自动消耗） |
| `/钓鱼记录` | `/钓鱼日志`、`/钓鱼历史` | 查看最近钓鱼记录 |
| `/钓鱼帮助` | `/钓鱼菜单`、`/菜单` | 查看帮助菜单 |

### 🎒 背包与资产管理

| 命令 | 别名 | 描述 |
|---|---|---|
| `/状态` | `/我的状态` | 查看个人详细状态 |
| `/背包` | `/查看背包`、`/我的背包` | 查看我的所有物品 |
| `/鱼塘` | - | 查看鱼塘中的所有鱼 |
| `/偷看鱼塘 [@用户]` | `/查看鱼塘 [@用户]`、`/偷看 [@用户]` | 查看其他用户的鱼塘 |
| `/鱼塘容量` | - | 查看当前鱼塘容量 |
| `/升级鱼塘` | `/鱼塘升级` | 升级鱼塘容量 |
| `/水族箱` | - | 查看水族箱中的所有鱼 |
| `/水族箱 帮助` | - | 水族箱系统帮助信息 |
| `/放入水族箱 [FID] [数量]` | `/移入水族箱 [FID] [数量]` | 将鱼从鱼塘移入水族箱 |
| `/移出水族箱 [FID] [数量]` | `/移回鱼塘 [FID] [数量]` | 将鱼从水族箱移回鱼塘 |
| `/升级水族箱` | `/水族箱升级` | 升级水族箱容量 |
| `/鱼竿` | - | 查看我的鱼竿 |
| `/鱼饵` | - | 查看我的鱼饵 |
| `/饰品` | - | 查看我的饰品 |
| `/道具` | `/我的道具`、`/查看道具` | 查看我的道具 |
| `/使用 [短码]` | `/装备 [短码]` | 使用指定短码的物品（R=鱼竿，A=饰品，D=道具，B=鱼饵） |
| `/开启全部钱袋` | `/打开全部钱袋`、`/打开所有钱袋` | 一次性开启所有钱袋类道具 |
| `/精炼 [短码]` | `/强化 [短码]` | 精炼指定短码的鱼竿或饰品（无参数时显示帮助） |
| `/出售 [短码]` | `/卖出 [短码]` | 出售指定短码的物品（R=鱼竿，A=饰品，D=道具） |
| `/锁定 [短码]` | `/上锁 [短码]` | 锁定指定短码的鱼竿或饰品，防止误操作 |
| `/解锁 [短码]` | `/开锁 [短码]` | 解锁指定短码的鱼竿或饰品，允许正常操作 |
| `/金币` | - | 查看金币余额 |
| `/高级货币` | `/钻石`、`/星石` | 查看高级货币余额 |

### 🛒 商店与市场

| 命令 | 别名 | 描述 |
|---|---|---|
| `/全部卖出` | `/全部出售`、`/卖出全部`、`/出售全部`、`/清空鱼` | 一键卖出鱼塘所有鱼 |
| `/保留卖出` | `/保留出售`、`/卖出保留`、`/出售保留` | 卖出所有鱼但每种保留一条 |
| `/砸锅卖铁` | `/破产`、`/清空`、`/清仓` | 出售所有未锁定且未装备的鱼竿、饰品和全部鱼类 |
| `/出售稀有度 [1-5]` | `/稀有度出售 [1-5]`、`/出售星级 [1-5]` | 卖出指定稀有度的鱼 |
| `/出售所有鱼竿` | `/出售全部鱼竿`、`/卖出所有鱼竿`、`/卖出全部鱼竿`、`/清空鱼竿` | 一键出售所有(非在用/非保护)鱼竿（逐件按新规则计价） |
| `/出售所有饰品` | `/出售全部饰品`、`/卖出所有饰品`、`/卖出全部饰品`、`/清空饰品` | 一键出售所有(非在用/非保护)饰品（逐件按新规则计价） |
| `/商店` | - | 查看商店列表或指定商店详情（支持多商店系统） |
| `/商店购买 [商店ID] [商品ID] [数量]` | `/购买商店商品 [商店ID] [商品ID] [数量]`、`/购买商店 [商店ID] [商品ID] [数量]` | 从指定商店购买商品（数量默认为1，支持复杂成本机制） |
| `/市场` | - | 查看玩家交易市场 |
| `/上架 [短码] [价格] [数量] [匿名]` | - | 将物品上架到市场（R=鱼竿，A=饰品，D=道具，F=鱼类） |
| `/购买 [ID]` | - | 从市场购买商品 |
| `/我的上架` | `/上架列表`、`/我的商品`、`/我的挂单` | 查看我上架的商品 |
| `/下架 [ID]` | - | 下架我的商品 |

### 💰 出售定价与配置（鱼竿/饰品）

- 系统回收价计算：`售价 = 基础价(按稀有度) × 精炼等级乘数`
- 适用范围：`/出售 [短码]`、`/出售所有鱼竿`、`/出售所有饰品`
- 批量出售会跳过正在装备的物品

配置示例（位于插件运行时装配的 `game_config` 中）：

```json
{
  "sell_prices": {
    "rod": { "1": 100, "2": 500, "3": 2000, "4": 5000, "5": 10000 },
    "accessory": { "1": 100, "2": 500, "3": 2000, "4": 5000, "5": 10000 },
    "refine_multiplier": {
      "1": 1.0, "2": 1.6, "3": 3.0, "4": 6.0, "5": 12.0,
      "6": 25.0, "7": 55.0, "8": 125.0, "9": 280.0, "10": 660.0
    }
  }
}
```

- 你可以按需调整不同稀有度的基础价，或调整各精炼等级的乘数曲线（当前默认为递增、近指数型曲线，鼓励高精炼装备的投资回报）。
- 市场玩家间交易价格不受上述配置限制，由卖家自定。


### 🛒 全新商店系统说明（2.0版本）

- **多商店类型**：支持普通商店、高级商店、限时商店三种类型
- **复杂商品机制**：支持多种成本类型组合（金币、高级货币、鱼竿、饰品、道具）
- **成本分组系统**：支持复杂的成本组合逻辑，组内支持AND/OR关系
- **时间控制**：支持商店营业时间、每日营业时间、商品限时销售
- **限购机制**：支持每人限购、每日限购等购买限制
- **库存管理**：支持商品库存控制和销售统计
- **商品类型扩展**：支持鱼竿、饰品作为商店商品
- **Web管理**：管理员可通过Web界面管理商店和商品

#### 商店命令使用示例

```
/商店                    # 查看所有商店列表
/商店 1                  # 查看商店1的详情和商品
/商店购买 1 2 5          # 从商店1购买商品2，数量5个
```

### 🐟 鱼类市场系统（2.0版本）

- **鱼类交易**：支持鱼类上架到市场进行交易
- **匿名上架**：支持匿名上架商品，保护卖家隐私
- **统一上架**：使用 `/上架 [短码] [价格] [数量] [匿名]` 命令
- **鱼类短码**：鱼类使用 `F` 开头的短码（如 F3）
- **市场显示**：市场中的鱼类会显示稀有度和价值信息

#### 鱼类市场使用示例

```
/上架 F3 100 5          # 上架鱼类F3，价格100金币，数量5个
/上架 F5 500 1 匿名     # 匿名上架鱼类F5，价格500金币，数量1个
/市场                    # 查看市场中的鱼类和其他商品
```

### 🔍 偷看鱼塘功能（2.0版本）

- **查看他人鱼塘**：可以查看其他用户的鱼塘和鱼类收藏
- **隐私保护**：只能查看鱼塘内容，不能进行其他操作
- **统计信息**：显示目标用户的总鱼数和总价值
- **稀有度分组**：按稀有度分组显示鱼类，便于查看

#### 偷看鱼塘使用示例

```
/偷看鱼塘 @用户          # 查看指定用户的鱼塘
/偷看鱼塘 123456789     # 查看指定用户ID的鱼塘
```

### 🐠 水族箱系统（2.0版本）

- **安全存储空间**：水族箱中的鱼不会被偷取，提供完全保护
- **容量管理**：默认50条容量，支持10级升级（最高2000条）
- **智能转移**：支持鱼塘与水族箱之间的双向转移
- **市场集成**：从市场购买的鱼默认放入水族箱
- **升级机制**：使用金币和钻石升级容量，费用递增
- **统一短码**：使用F开头的短码（如F3）进行操作

#### 水族箱使用示例

```
/水族箱                 # 查看水族箱中的鱼
/水族箱 帮助            # 查看水族箱系统帮助
/放入水族箱 F3 5        # 将5条F3鱼从鱼塘移入水族箱
/移出水族箱 F3 2        # 将2条F3鱼从水族箱移回鱼塘
/升级水族箱             # 升级水族箱容量
```

### 💼 交易所系统（2.1.0版本）

- **大宗商品交易**：支持鱼干、鱼油、鱼卵等大宗商品的买卖交易
- **动态价格系统**：商品价格每日波动，模拟真实市场环境
- **容量管理**：总持仓上限1000份，增加策略性投资决策
- **腐败机制**：商品有腐败时间，过期后自动清理
- **盈亏分析**：详细的买入卖出盈亏分析，帮助用户了解投资表现
- **市场集成**：大宗商品可上架到玩家市场进行交易
- **税收系统**：交易收取5%税费，增加经济平衡性
- **统一短码**：使用C开头的短码（如C1A）进行操作

#### 交易所命令

| 命令 | 别名 | 描述 |
|---|---|---|
| `/交易所` | - | 查看交易所主菜单和帮助信息 |
| `/交易所 开户` | - | 开通交易所账户（花费100,000金币） |
| `/交易所 状态` | - | 查看当前市场状态和商品价格 |
| `/交易所 买入 [商品名称] [数量]` | - | 购买指定数量的大宗商品 |
| `/交易所 卖出 [商品名称]` | - | 卖出所有指定商品 |
| `/交易所 卖出 [CID] [数量]` | - | 按ID卖出指定数量商品 |
| `/持仓` | - | 查看我的大宗商品库存 |
| `/清仓` | - | 清空所有大宗商品库存 |
| `/清仓 [商品名称]` | - | 清空指定商品库存 |
| `/清仓 all` | - | 清空所有大宗商品库存 |

#### 交易所系统特点

**🔄 动态价格机制**
- 每日价格波动，基于趋势、随机性和特殊事件
- 价格在合理范围内波动，避免极端情况
- 支持价格历史查询和趋势分析

**📦 商品腐败系统**
- 鱼干：1-3天腐败时间（每日固定）
- 鱼油：1-3天腐败时间（每日固定）
- 鱼卵：1-3天腐败时间（每日固定）
- 腐败商品自动清理，不返还成本

**💰 盈亏分析功能**
- 详细显示总成本、总收入、净盈亏
- 计算盈利率，帮助用户了解投资表现
- 单项商品盈亏分析，清仓时显示详细统计

**🏪 市场集成**
- 大宗商品可上架到玩家市场
- 支持匿名上架，保护卖家隐私
- 市场购买的商品自动入库到交易所

**⚖️ 容量与税收**
- 总持仓上限：1000份（可配置）
- 交易税率：5%（可配置）
- 上架商品仍占用容量，被购买后释放

#### 交易所使用示例

```
/交易所                 # 查看交易所主菜单
/交易所 开户            # 开通交易所账户
/交易所 状态            # 查看当前市场价格
/交易所 买入 鱼油 10     # 购买10份鱼油
/持仓                   # 查看我的商品库存
/交易所 卖出 鱼油       # 卖出所有鱼油
/清仓                   # 清空所有库存
/上架 C1A 1000 5        # 上架5份C1A商品到市场
```

#### 盈亏分析示例

```
✅ 成功出售所有 5份 鱼油
💰 获得 15000 金币（已扣除 750 交易税）

📊 盈亏分析：
• 总成本：12000 金币
• 总收入：15750 金币
• 净盈亏：+3750 金币 📈盈利
• 盈利率：+31.3%
```

### 🎮 新游戏玩法（2.2.0版本）

#### ⚡ 电鱼功能

- **电击鱼塘**：可以电击其他玩家的鱼塘，获得特殊奖励
- **冷却机制**：电鱼有冷却时间，防止过度使用
- **风险与收益**：电鱼可能获得金币、道具或特殊鱼类
- **社交互动**：增加玩家间的互动和竞争
- **功能开关**：管理员可通过配置文件控制电鱼功能的启用/禁用
- **道具交互**：与守护海灵、破灵符、暗影斗篷、驱灵香等道具完全兼容

#### 🎲 猜大小游戏

- **多种下注方式**：支持大小、单双、点数等多种下注类型
- **概率游戏**：基于骰子结果的概率游戏
- **冷却机制**：防止频繁游戏，保持游戏平衡
- **风险控制**：玩家可以控制下注金额

#### 🎰 命运之轮

- **轮盘游戏**：高风险高回报的策略性轮盘游戏
- **多轮挑战**：支持10层挑战，可以随时继续或放弃
- **高风险定位**：起始成功率65%，符合轮盘游戏的刺激特性
- **第1层诱惑**：第1层期望微盈利（0.75%），吸引玩家尝试
- **风险递增**：第2层开始期望亏损，成功率从60%递减至20%
- **高倍率奖励**：通关倍率高达数百倍，刺激冒险玩家挑战
- **每日限制**：每天最多可玩3次（可配置），平衡游戏经济
- **庄家优势**：整体House Edge约67%，确保长期回收货币

#### 📦 批量稀有度出售

- **按稀有度出售**：支持按稀有度批量出售鱼类
- **提升效率**：快速清理低稀有度鱼类
- **灵活选择**：可以选择出售特定稀有度的鱼类
- **价格优化**：按稀有度分别计算出售价格

### 🎫 通行证机制说明

- **智能通行证系统**：特定钓鱼区域需要持有对应通行证才能进入
- **自动消耗机制**：使用 `/钓鱼区域 [ID]` 切换区域时，如果该区域需要通行证，系统会自动消耗一个通行证
- **通行证道具**：通行证道具设置为不可直接使用，防止误操作消耗
- **区域配置**：管理员可通过Web后台或命令设置各区域的通行证要求
- **成本透明**：每个区域都会显示钓鱼消耗和通行证要求，帮助用户做出明智选择

### 🌟 稀有度系统说明（2.0版本）

- **扩展稀有度**：支持1-10星稀有度，打破传统5星限制
- **颜色映射**：新增6-10星稀有度专属颜色显示
  - 6星：深蓝色
  - 7星：紫色
  - 8星：金色
  - 9星：彩虹色
  - 10星：传说色（特殊效果）
- **图鉴显示**：鱼类图鉴中高稀有度鱼类使用对应颜色显示
- **背包显示**：装备背包中稀有度星级使用对应颜色

### 🎰 抽卡与概率玩法

| 命令 | 别名 | 描述 |
|---|---|---|
| `/抽卡 [卡池ID]` | `/抽奖 [卡池ID]` | 进行单次抽卡 |
| `/十连 [卡池ID]` | - | 进行十连抽卡 |
| `/查看卡池 [ID]` | `/卡池` | 查看卡池详情 |
| `/抽卡记录` | - | 查看我的抽卡记录 |
| `/擦弹 [金额]` | - | 进行擦弹游戏 (可填allin/halfin) |
| `/擦弹记录` | `/擦弹历史` | 查看我的擦弹记录 |
| `/骰子 [类型] [金额]` | - | 进行猜大小游戏（大小/单双/点数） |
| `/命运之轮 [金额]` | - | 开始命运之轮游戏 |
| `/继续` | - | 继续命运之轮游戏 |
| `/放弃` | - | 放弃命运之轮游戏 |

#### 擦弹功能优化（2.0版本）
- **消息格式优化**：简化擦弹结果消息，突出关键信息
- **抑制通知**：添加服务器级别抑制状态检查，避免消息刷屏
- **智能显示**：根据擦弹结果智能调整消息长度和内容
##### 理论概率分布

| 区间 | 倍率范围        | 权重  | 概率    | 平均倍率 | 说明       |
|------|-----------------|-------|---------|----------|------------|
| 1    | 0.0-0.2倍       | 10000 | 11.47%  | 0.1倍    | 严重亏损   |
| 2    | 0.2-0.5倍       | 18000 | 20.65%  | 0.3倍    | 普通亏损   |
| 3    | 0.5-0.8倍       | 15000 | 17.21%  | 0.7倍    | 小亏损     |
| 4    | 0.8-1.2倍       | 25000 | 28.68%  | 1.0倍    | 小赚       |
| 5    | 1.2-2.0倍       | 14100 | 16.18%  | 1.6倍    | 中赚       |
| 6    | 2.0-3.0倍       | 4230  | 4.85%   | 2.5倍    | 大赚       |
| 7    | 3.0-6.0倍       | 705   | 0.81%   | 4.5倍    | 超大赚     |
| 8    | 6.0-15.0倍      | 106   | 0.12%   | 10.5倍   | 高倍率     |
| 9    | 15.0-50.0倍     | 21    | 0.02%   | 32.5倍   | 超级大奖   |
| 10   | 50.0-200.0倍    | 7     | 0.01%   | 125.0倍  | 传说级奖励 |
| 11   | 200.0-1500.0倍  | 1     | 0.00%   | 850.0倍  | 神话级奖励 |

### 👥 社交功能

| 命令 | 别名 | 描述 |
|---|---|---|
| `/排行榜` | `/phb` | 查看金币排行榜 |
| `/偷鱼 [@用户]` | - | 偷取指定用户的一条鱼 |
| `/电鱼 [@用户]` | - | 电击指定用户的鱼塘，获得特殊奖励 |
| `/驱灵 [@用户]` | - | 驱散目标的海灵守护（需持有驱灵香） |
| `/偷看鱼塘 [@用户]` | `/查看鱼塘 [@用户]`、`/偷看 [@用户]` | 查看其他用户的鱼塘和鱼类收藏 |
| `/查看称号` | `/称号` | 查看我拥有的称号 |
| `/使用称号 [ID]` | - | 装备指定ID称号 |
| `/查看成就` | `/成就` | 查看我的成就进度 |
| `/税收记录` | - | 查看我的税收记录 |
| `/鱼类图鉴` | `/图鉴` | 查看已解锁的鱼类图鉴 |

### ⚙️ 管理后台（管理员）

| 命令 | 别名 | 描述 |
|---|---|---|
| `/修改金币 [用户ID] [数量]` | - | 修改用户金币 |
| `/奖励金币 [用户ID] [数量]` | - | 奖励用户金币 |
| `/扣除金币 [用户ID] [数量]` | - | 扣除用户金币 |
| `/修改高级货币 [用户ID] [数量]` | - | 修改高级货币 |
| `/奖励高级货币 [用户ID] [数量]` | - | 奖励高级货币 |
| `/扣除高级货币 [用户ID] [数量]` | - | 扣除高级货币 |
| `/全体奖励金币 [数量]` | - | 给所有用户发放金币 |
| `/全体奖励高级货币 [数量]` | - | 给所有用户发放高级货币 |
| `/全体扣除金币 [数量]` | - | 从所有用户扣除金币 |
| `/全体扣除高级货币 [数量]` | - | 从所有用户扣除高级货币 |
| `/全体发放道具 [道具ID] [数量]` | - | 给所有用户发放指定道具（管理员） |
| `/开启钓鱼后台管理` | - | 启动 Web 管理后台（管理员） |
| `/关闭钓鱼后台管理` | - | 关闭 Web 管理后台（管理员） |
| `/代理上线 [用户ID]` | `/login [用户ID]` | 扮演指定用户，方便调试（管理员） |
| `/代理下线` | `/logout` | 结束扮演（管理员） |
| `/同步初始设定` | `/同步设定`, `/同步数据`, `/同步` | 从 initial_data.py 同步商店、道具等模板数据（管理员） |

---

## 👥 社区与贡献

### 🤝 如何贡献

我们欢迎各种形式的贡献！无论您是开发者、用户还是爱好者，都可以为项目做出贡献：

#### 对于开发者
- 🐛 **报告Bug**：在 [Issues](https://github.com/xxlemon-io/astrbot_plugin_fishing/issues) 中报告发现的问题
- 💡 **功能建议**：提出新功能想法和改进建议
- 🔧 **代码贡献**：提交 Pull Request 改进代码
- 📖 **文档完善**：帮助完善文档和注释

#### 对于用户
- ⭐ **Star支持**：给项目点个Star，让更多人看到
- 📝 **使用反馈**：分享使用体验和建议
- 🐛 **问题报告**：报告使用中遇到的问题
- 💬 **社区讨论**：参与社区讨论，分享使用技巧

### 📋 贡献指南

1. **Fork** 本仓库
2. 创建您的特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交您的更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 打开一个 **Pull Request**

### 📄 代码规范

- 遵循 Python PEP 8 代码规范
- 添加适当的注释和文档字符串
- 确保代码通过所有测试
- 提交信息使用清晰的中文描述

### 🏆 贡献者

感谢所有为这个项目做出贡献的开发者们！

<a href="https://github.com/xxlemon-io/astrbot_plugin_fishing/graphs/contributors">
  <img src="https://contrib.rocks/image?repo=xxlemon-io/astrbot_plugin_fishing" />
</a>

## 📞 支持与联系

- 🐛 **问题反馈**：[GitHub Issues](https://github.com/xxlemon-io/astrbot_plugin_fishing/issues)
- 💬 **讨论交流**：[GitHub Discussions](https://github.com/xxlemon-io/astrbot_plugin_fishing/discussions)
- 📧 **邮件联系**：通过 GitHub 个人资料联系

## 🙏 致谢与项目来源

本项目基于以下开源项目进行开发：

- **原始版本**：[@baa131/astrbot_plugin_fishing](https://github.com/baa131/astrbot_plugin_fishing) v1.0.0
- **基础版本**：[@tinkerbellqwq/astrbot_plugin_fishing](https://github.com/tinkerbellqwq/astrbot_plugin_fishing) v1.4.6

感谢原作者的贡献和开源精神，让我们能够在此基础上继续改进和完善这个项目。

## 📜 开源协议与法律声明

本项目基于 [AGPL-3.0](https://opensource.org/licenses/AGPL-3.0) 开源协议发布。

### 协议要点
- ✅ **商业使用**：允许商业使用
- ✅ **修改**：允许修改和分发
- ✅ **专利使用**：允许专利使用
- ✅ **私人使用**：允许私人使用
- ⚠️ **开源要求**：基于本项目的衍生作品必须同样开源
- ⚠️ **网络服务**：通过网络提供服务的衍生作品也必须开源

### 免责声明
- 本项目仅供学习和娱乐使用
- 使用者需自行承担使用风险
- 开发者不对任何直接或间接损失负责

---

<div align="center">

**如果这个项目对您有帮助，请给我们一个 ⭐ Star！**

Made with ❤️ by the AstrBot Fishing Plugin Community

</div>
